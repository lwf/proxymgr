#!/usr/bin/env ruby
$LOAD_PATH.unshift File.expand_path(File.join(__FILE__, '..', '..', 'lib'))

require 'proxymgr'
require 'yaml'
require 'docopt'

Thread.abort_on_exception = true

opt = <<OPT
ProxyMgr manages Haproxy dynamically.

Usage:
  #{__FILE__} -c=<path> | --config=<path> [-d|--debug]

Options:
  -c=<path> --config=<path>   Set configuration file path
  -d --debug                  Turn on debug logging
OPT

begin
  require 'pp'
  opts = Docopt.docopt(opt)
rescue Docopt::Exit => e
  $stderr.puts e.message
  exit 1
end

ProxyMgr::Runner.new(opts['--config'], opts['--debug'] ? Logger::DEBUG : Logger::INFO).run
